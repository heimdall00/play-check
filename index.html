<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>$PLAY Allocation Checker - TGE Disaster Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b0b1a;
      --card: #111127;
      --accent: #9d4edd;
      --text: #e0e0ff;
      --glow: 0 0 16px rgba(157,78,221,0.6);
      --glow-strong: 0 0 32px rgba(157,78,221,0.9);
      --warn: #ff6b6b;
      --btn-glow: 0 0 20px rgba(157,78,221,0.5);
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      background: var(--bg); color: var(--text); font-family: 'Inter', system-ui;
      display: flex; flex-direction: column; align-items: center; min-height: 100vh;
      position: relative; overflow-x: hidden;
    }

    .bg-particles {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
      pointer-events: none;
    }
    .particle {
      position: absolute; width: 4px; height: 4px; background: rgba(157,78,221,0.3);
      border-radius: 50%; box-shadow: 0 0 10px rgba(157,78,221,0.5);
      animation: float 15s infinite linear;
    }
    @keyframes float {
      0% { transform: translateY(100vh) translateX(-50px); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100px) translateX(50px); opacity: 0; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.85; transform: scale(1.01); }
    }

    header {
      width: 100%; text-align: center; padding: 1.8rem 1rem 1.2rem;
      background: linear-gradient(to bottom, #1a1a2e, transparent);
      position: relative; z-index: 10;
    }
    header img {
      max-width: 100%; height: auto; max-height: 220px;
      filter: drop-shadow(0 0 30px rgba(157,78,221,0.7));
      border-radius: 16px;
      animation: float-header 6s ease-in-out infinite;
    }
    @keyframes float-header { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }

    .top-bar {
      display: flex; justify-content: center; align-items: center; width: 100%; max-width: 680px;
      margin: 0.5rem auto 0; padding: 0 1rem; font-size: 0.9rem; flex-wrap: wrap; gap: 0.6rem;
    }
    .countdown {
      background: rgba(157,78,221,0.15); padding: 0.4rem 0.8rem; border-radius: 12px;
      border: 1px solid rgba(157,78,221,0.3); color: var(--accent); font-weight: 600;
    }
    .top-btn {
      background: linear-gradient(135deg, #7b3cd0, #9d4edd);
      color: white; padding: 0.5rem 1rem; border-radius: 16px; font-size: 0.85rem;
      text-decoration: none; font-weight: 600; box-shadow: var(--btn-glow);
      transition: all 0.3s;
    }
    .top-btn:hover { transform: translateY(-2px); box-shadow: 0 0 25px rgba(157,78,221,0.7); }

    main { width: 100%; max-width: 680px; padding: 1.5rem; z-index: 5; }
    h1 { font-size: 2.1rem; margin: 0.6rem 0; text-align: center; }

    .warning {
      background: rgba(255,107,107,0.15); border: 2px solid var(--warn);
      border-radius: 16px; padding: 1.2rem; margin: 1.5rem 0;
      text-align: center; font-weight: 600; color: #ffcccc;
      box-shadow: 0 0 20px rgba(255,107,107,0.3);
    }
    .disaster-banner {
      background: rgba(255,0,0,0.25); border: 3px solid #ff0000;
      animation: pulse 2s infinite;
    }
    .info-box {
      background: rgba(157,78,221,0.15); border: 1px solid rgba(157,78,221,0.3);
      border-radius: 16px; padding: 1rem; margin: 1rem 0; font-size: 0.9rem;
    }
    .info-box ul {
      margin: 0.5rem 0 0 1.5rem; text-align: left; line-height: 1.8;
    }

    .search-box { position: relative; margin: 2rem 0; }
    #search {
      width: 100%; padding: 1.1rem 1.3rem; font-size: 1.15rem;
      background: rgba(255,255,255,0.06); border: 2px solid rgba(157,78,221,0.4);
      border-radius: 18px; color: var(--text); outline: none;
      box-shadow: var(--glow); transition: all 0.3s;
    }
    #search:focus { border-color: var(--accent); box-shadow: var(--glow-strong); }

    #autocomplete {
      position: absolute; top: 100%; left: 0; right: 0; z-index: 100;
      max-height: 340px; overflow-y: auto; background: var(--card);
      border-radius: 0 0 18px 18px; border: 2px solid rgba(157,78,221,0.4);
      margin-top: -2px; display: none; box-shadow: var(--glow);
    }
    .auto-item {
      padding: 1rem 1.3rem; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .auto-item:hover, .auto-item.highlight { background: rgba(157,78,221,0.25); }

    .result {
      background: var(--card); border-radius: 22px; padding: 2rem;
      margin-top: 2rem; box-shadow: 0 14px 48px rgba(0,0,0,0.45);
      display: none; animation: fadeIn 0.4s ease-out;
    }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:none; } }
    .value { color: var(--accent); font-weight: 600; }
    .scenario { margin: 0.8rem 0; padding: 1rem; background: rgba(157,78,221,0.1); border-radius: 10px; }
    .psg1-input {
      display: flex; align-items: center; gap: 0.8rem; margin: 1rem 0; font-size: 0.9rem;
    }
    .psg1-input input[type="number"] {
      width: 60px; padding: 0.5rem; background: rgba(255,255,255,0.06);
      border: 1px solid rgba(157,78,221,0.4); border-radius: 8px; color: var(--text);
    }

    .btn-row {
      display: flex; justify-content: center; gap: 1rem; margin: 1.5rem 0; flex-wrap: wrap;
    }
    .btn {
      padding: 0.9rem 1.8rem; border-radius: 16px; font-weight: 600; font-size: 1rem;
      text-align: center; text-decoration: none; color: white; cursor: pointer;
      box-shadow: var(--btn-glow); transition: all 0.3s; min-width: 140px;
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 0 30px rgba(157,78,221,0.8); }
    .btn-share { background: linear-gradient(135deg, #7b3cd0, #9d4edd); }
    .btn-coffee { background: linear-gradient(135deg, #f7931a, #e68619); animation: wiggle 2s infinite; }
    .btn-follow { background: linear-gradient(135deg, #7b3cd0, #9d4edd); font-size: 0.9rem; }

    @keyframes wiggle {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-2px); }
    }

    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;
    }
    .modal-content {
      background: var(--card); border-radius: 20px; padding: 2rem; max-width: 500px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6); position: relative;
    }
    .close {
      position: absolute; top: 1rem; right: 1.5rem; font-size: 1.5rem; cursor: pointer; color: #aaa;
    }
    .close:hover { color: white; }

    footer {
      margin: 3.5rem 0 2rem; font-size: 0.82rem; opacity: 0.75; text-align: center; line-height: 1.6;
      z-index: 5;
    }
    footer em { font-style: normal; opacity: 0.9; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <div class="bg-particles" id="particles"></div>

  <header>
    <img src="PSG1Header.svg" alt="PlaySolana PSG1">
  </header>

  <div class="top-bar">
    <div class="countdown">TGE LAUNCHED</div>
    <a href="https://genesis.playsolana.com/claim" target="_blank" class="top-btn">Claim Site</a>
    <a href="https://x.com/playsolana" target="_blank" class="top-btn">Follow @PlaySolana</a>
    <a href="https://www.playsolana.com/litepaper" target="_blank" class="top-btn">Litepaper</a>
    <div class="top-btn" onclick="openModal()">Tokenomics</div>
  </div>

  <main>
    <h1>$PLAY Allocation Checker</h1>

    <div class="warning disaster-banner">
      <strong>üö® TGE DISASTER - TOKEN LAUNCH COMPROMISED üö®</strong><br>
      24 wallets claimed BEFORE TGE and dumped on launch.<br>
      Last-minute 30% claim tax added WITHOUT prior notice.<br>
      <small style="opacity:0.9;">Price crashed from $0.04 to $0.007 (-82%)</small>
    </div>

    <div class="info-box" style="background: rgba(255,107,107,0.15); border: 2px solid var(--warn);">
      <strong>‚ö†Ô∏è WHAT HAPPENED:</strong>
      <ul>
        <li><strong>Metaplex:</strong> Pushed for 30% claim tax at the last minute</li>
        <li><strong>PlaySolana Team:</strong> Failed to communicate this tax to community</li>
        <li><strong>Security Breach:</strong> 24 wallets exploited Web2 API to claim early & dump</li>
        <li><strong>Result:</strong> Community lost 30% of allocation or forced into 3-12 month lockup</li>
      </ul>
    </div>

    <div class="info-box">
      <strong>CURRENT REALITY:</strong><br>
      ‚Ä¢ Claim now = <strong style="color: var(--warn);">70% of allocation</strong> (30% tax)<br>
      ‚Ä¢ Stake 3mo = <strong style="color: #ffcc66;">80%</strong> (base 70% + 10% bonus)<br>
      ‚Ä¢ Stake 6mo = <strong style="color: #66ff66;">98%</strong> (base 70% + 40% bonus)<br>
      ‚Ä¢ Stake 12mo = <strong style="color: #00ff00;">140%</strong> (base 70% + 100% bonus)<br>
      <small style="opacity:0.8;">Minimum 3 months locked to recover any meaningful allocation</small>
    </div>

    <div class="info-box" style="background: rgba(255,204,102,0.15); border: 1px solid #ffcc66; text-align: center;">
      <strong>Live $PLAY Price:</strong> $<span id="live-price" style="color: var(--accent); font-size: 1.3rem; font-weight: 700;">Loading...</span>
      <span id="price-change" style="margin-left: 0.5rem; font-size: 0.9rem;"></span><br>
      <small style="opacity:0.7;">Auto-updates from DexScreener/Jupiter (if CORS allows)</small>
    </div>

    <div class="slider-container" style="margin: 1.5rem 0; font-size: 0.9rem;">
      <label style="display: block; margin-bottom: 0.5rem; text-align: center;">
        Manual Price Override: $<span id="price-val" style="color: var(--accent); font-weight: 600;">0.017</span>
      </label>
      <input type="range" id="price-slider" min="0.001" max="0.1" value="0.017" step="0.001" style="width: 100%; height: 8px; border-radius: 4px; background: #333; outline: none; -webkit-appearance: none; touch-action: pan-y;">
      <small style="display: block; text-align: center; opacity: 0.7; margin-top: 0.3rem;">
        Use slider if live price fails to load
      </small>
    </div>

    <style>
      #price-slider::-webkit-slider-thumb {
        -webkit-appearance: none; width: 20px; height: 20px;
        background: var(--accent); border-radius: 50%; cursor: pointer;
        box-shadow: var(--glow);
      }
      #price-slider::-moz-range-thumb {
        width: 20px; height: 20px; background: var(--accent); border-radius: 50%;
        cursor: pointer; box-shadow: var(--glow); border: none;
      }
    </style>

    <div class="warning" style="background: rgba(157,78,221,0.15); border: 1px solid rgba(157,78,221,0.3);">
      <strong>‚ö†Ô∏è LEADERBOARD DATA IS POST-SNAPSHOT</strong><br>
      XP values may be slightly higher than snapshot (users kept earning XP).<br>
      Tool should be close, but check genesis.playsolana.com/claim for exact allocation.<br>
      <small style="opacity:0.8;"><strong>Estimated: ~0.75 $PLAY per XP | 10k $PLAY per PSG1</strong></small>
    </div>

    <div class="search-box">
      <input type="text" id="search" placeholder="e.g. VOODOORANGER" autocomplete="off" />
      <div id="autocomplete"></div>
    </div>

    <div id="status" style="text-align:center; margin:1.2rem 0; color:#888;"></div>

    <div id="output" class="result">
      <p>User: <span id="show-name" class="value"></span> <small>(Rank <span id="show-rank"></span>)</small></p>
      <p>XP: <span id="show-xp" class="value"></span> <small style="color:#ffcc66;">(May be slightly post-snapshot)</small></p>
      <hr style="margin: 1rem 0; border: none; border-top: 1px solid rgba(255,255,255,0.1);">

      <div class="psg1-input" id="psg1-section" style="display:none;">
        <label><input type="checkbox" id="has-psg1"> I have PSG1 device(s)</label>
        <input type="number" id="psg1-count" min="1" max="10" value="1" disabled>
      </div>

      <div class="scenario">
        <strong>üéØ Full Allocation (100% @ snapshot):</strong><br>
        <span id="full-play" class="value"></span> $PLAY ‚Üí $<span id="full-usd" class="value"></span> USD
      </div>

      <div class="scenario" style="background: rgba(255,107,107,0.15);">
        <strong>üíî Instant Claim (70% after 30% tax):</strong><br>
        <span id="instant-play" class="value"></span> $PLAY ‚Üí $<span id="instant-usd" class="value"></span> USD
      </div>

      <div class="scenario">
        <strong>‚è≥ Staking Options (to recover/exceed allocation):</strong><br>
        <div style="margin-top: 0.5rem;">
          3 Mo ‚Üí 80%: <span id="stake-3" class="value"></span> $PLAY ($<span id="stake-3-usd"></span>)<br>
          6 Mo ‚Üí 98%: <span id="stake-6" class="value"></span> $PLAY ($<span id="stake-6-usd"></span>)<br>
          9 Mo ‚Üí 112%: <span id="stake-9" class="value"></span> $PLAY ($<span id="stake-9-usd"></span>)<br>
          12 Mo ‚Üí 140%: <span id="stake-12" class="value"></span> $PLAY ($<span id="stake-12-usd"></span>)
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-share" onclick="shareOnX()">Share on X</button>
        <button class="btn btn-coffee" onclick="copySol()">Buy Me a Coffee (SOL)</button>
        <a href="https://x.com/Heimdall0_0" target="_blank" class="btn btn-follow">Follow @Heimdall0_0</a>
      </div>

      <p style="font-size:0.8rem; opacity:0.7; text-align:center; margin-top:0.5rem;">
        2GwHm5n8KbHgruhfVWHRukRGKoj4QVNC7Q2NCKw5xPph
      </p>
    </div>
  </main>

  <div id="tokenomics-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">√ó</span>
      <h2>$PLAY Tokenomics (5B Total Supply)</h2>
      <ul style="list-style:none; text-align:left; font-size:0.9rem; line-height:1.7;">
        <li><strong>26%</strong> PlaySolana Superhub</li>
        <li><strong>22%</strong> Community</li>
        <li><strong>16%</strong> PlaySolana Contributors</li>
        <li><strong>10%</strong> Liquidity</li>
        <li><strong>10%</strong> PlaySolana Investors</li>
        <li><strong>8%</strong> Treasury</li>
        <li><strong>5%</strong> Labs</li>
        <li><strong>3%</strong> Metaplex</li>
      </ul>
      <p style="margin-top:1rem; font-size:0.85rem; opacity:0.8;">
        <strong>Estimated Allocation:</strong><br>
        <strong>PSG1 Holders:</strong> 10,000 $PLAY per device (confirmed)<br>
        <em>(10,000 minted ‚Üí 100M $PLAY total)</em><br>
        <strong>XP Rewards:</strong> ~0.75 $PLAY per XP (estimated)<br>
        <em>(125.6M total XP ‚Üí ~94M $PLAY total)</em>
      </p>
      <hr style="margin: 1rem 0; border-color: rgba(255,255,255,0.1);">
      <p style="font-size:0.85rem; opacity:0.8; color: var(--warn);">
        <strong>‚ö†Ô∏è CLAIM TAX:</strong> 30% penalty for instant claim (you get 70%)<br>
        <strong>STAKING:</strong> Lock for 3-12 months to recover/exceed 100%
      </p>
    </div>
  </div>

  <footer>
    TGE: November 14, 2025 @ 12:30 UTC | Data from PlayDex (post-snapshot)<br>
    <em>Tool uses estimated rate: ~0.75 $PLAY per XP. Verify on claim site for exact values.</em><br>
    <strong style="color: var(--warn);">30% claim tax. Minimum 3mo stake to recover allocation.</strong>
  </footer>

  <script>
    const TOTAL_XP = 125598035;
    const TOTAL_SUPPLY = 5000000000;
    const XP_RATE = 0.75; // Estimated: ~0.75 $PLAY per XP
    const PSG1_PER_DEVICE = 10000; // Confirmed: 10k $PLAY per PSG1
    const TOKENS_FOR_XP = TOTAL_XP * XP_RATE; // ~94.2M tokens
    const CLAIM_TAX = 0.30; // 30% tax on instant claim
    const SOL_ADDRESS = "2GwHm5n8KbHgruhfVWHRukRGKoj4QVNC7Q2NCKw5xPph";
    const PLAY_TOKEN_MINT = "PLAYaJfivDjWu5bmBv61PsxCx2zr9jyQ2j3yHZexMd9"; // $PLAY token address
    const WEBSITE_URL = "https://heimdall00.github.io/play-check";

    let users = [];
    let currentPrice = 0.017; // Will be updated by live price
    let hasPsg1 = false;
    let psg1Count = 1;
    let lastResult = {};

    // LIVE PRICE FETCHING
    async function fetchLivePrice() {
      try {
        // Try Jupiter Price API v6
        const response = await fetch(`https://price.jup.ag/v6/price?ids=${PLAY_TOKEN_MINT}`, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
          },
        });
        
        if (!response.ok) throw new Error('Jupiter API failed');
        
        const data = await response.json();
        if (data.data && data.data[PLAY_TOKEN_MINT]) {
          const priceData = data.data[PLAY_TOKEN_MINT];
          currentPrice = priceData.price;
          
          // Update both displays
          document.getElementById('live-price').textContent = currentPrice.toFixed(6);
          document.getElementById('live-price').style.color = 'var(--accent)';
          document.getElementById('price-slider').value = currentPrice;
          document.getElementById('price-val').textContent = currentPrice.toFixed(3);
          
          // Show price change if available
          const changeSpan = document.getElementById('price-change');
          if (priceData.extraInfo && priceData.extraInfo['24hChange']) {
            const change = priceData.extraInfo['24hChange'];
            const color = change >= 0 ? '#00ff00' : '#ff6b6b';
            changeSpan.innerHTML = `<span style="color: ${color};">(${change >= 0 ? '+' : ''}${change.toFixed(2)}%)</span>`;
          }
          
          updateResult();
          return;
        }
        throw new Error('No price data');
      } catch (e) {
        console.error('Jupiter price fetch failed:', e);
        
        // Fallback: Try DexScreener API
        try {
          const response = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${PLAY_TOKEN_MINT}`);
          const data = await response.json();
          
          if (data.pairs && data.pairs.length > 0) {
            // Get the pair with highest liquidity
            const mainPair = data.pairs.sort((a, b) => b.liquidity.usd - a.liquidity.usd)[0];
            currentPrice = parseFloat(mainPair.priceUsd);
            
            // Update both displays
            document.getElementById('live-price').textContent = currentPrice.toFixed(6);
            document.getElementById('live-price').style.color = 'var(--accent)';
            document.getElementById('price-slider').value = currentPrice;
            document.getElementById('price-val').textContent = currentPrice.toFixed(3);
            
            const changeSpan = document.getElementById('price-change');
            if (mainPair.priceChange && mainPair.priceChange.h24) {
              const change = parseFloat(mainPair.priceChange.h24);
              const color = change >= 0 ? '#00ff00' : '#ff6b6b';
              changeSpan.innerHTML = `<span style="color: ${color};">(${change >= 0 ? '+' : ''}${change.toFixed(2)}%)</span>`;
            }
            
            updateResult();
            return;
          }
        } catch (e2) {
          console.error('DexScreener fallback failed:', e2);
        }
        
        // Final fallback - keep manual price from slider
        document.getElementById('live-price').textContent = currentPrice.toFixed(6);
        document.getElementById('live-price').style.color = '#ffcc66';
        const changeSpan = document.getElementById('price-change');
        changeSpan.innerHTML = '<span style="color: #888; font-size: 0.8rem;">(API blocked - use slider)</span>';
      }
    }

    // Fetch price on load and every 30 seconds
    fetchLivePrice();
    setInterval(fetchLivePrice, 30000);

    // PRICE SLIDER (manual override)
    const priceSlider = document.getElementById("price-slider");
    const priceVal = document.getElementById("price-val");

    priceSlider.addEventListener("input", () => {
      currentPrice = parseFloat(priceSlider.value);
      priceVal.textContent = currentPrice.toFixed(3);
      
      // Visual feedback that manual mode is active
      document.getElementById('live-price').textContent = currentPrice.toFixed(6);
      document.getElementById('live-price').style.color = '#ffcc66';
      document.getElementById('price-change').innerHTML = '<span style="color: #888; font-size: 0.8rem;">(manual override)</span>';
      
      updateResult();
    });

    // PSG1
    const psg1Check = document.getElementById("has-psg1");
    const psg1Input = document.getElementById("psg1-count");

    psg1Check.addEventListener("change", () => {
      hasPsg1 = psg1Check.checked;
      psg1Input.disabled = !hasPsg1;
      if (!hasPsg1) psg1Input.value = 1;
      updateResult();
    });

    psg1Input.addEventListener("input", () => {
      psg1Count = Math.max(1, Math.min(10, parseInt(psg1Input.value) || 1));
      psg1Input.value = psg1Count;
      updateResult();
    });

    // SHARE
    window.shareOnX = function() {
      const fullPlay = format(lastResult.fullPlay);
      const instantPlay = format(lastResult.instantPlay);
      const tweet = `I'm getting ${fullPlay} $PLAY from PlaySolana but only ${instantPlay} instantly (70%) due to 30% claim tax.\n\nTGE got REKT by early claimers & last-minute changes.\n\nCheck yours: ${WEBSITE_URL}\n\n#PlaySolana #TGE`;
      window.open(`https://x.com/intent/post?text=${encodeURIComponent(tweet)}`, '_blank');
    };

    window.copySol = () => { navigator.clipboard.writeText(SOL_ADDRESS); alert("SOL address copied!"); };
    window.openModal = () => document.getElementById("tokenomics-modal").style.display = "flex";
    window.closeModal = () => document.getElementById("tokenomics-modal").style.display = "none";

    // PARTICLES
    function createParticle() {
      const p = document.createElement("div"); p.className = "particle";
      p.style.left = Math.random() * 100 + "vw";
      p.style.animationDelay = Math.random() * 15 + "s";
      p.style.animationDuration = (Math.random() * 10 + 10) + "s";
      document.getElementById("particles").appendChild(p);
      setTimeout(() => p.remove(), 25000);
    }
    for (let i = 0; i < 30; i++) setTimeout(createParticle, i * 500);

    // LOAD & SEARCH
    async function loadData() {
      try {
        const resp = await fetch("leaderboard.json");
        if (!resp.ok) throw new Error("leaderboard.json not found");
        users = (await resp.json()).map((u, i) => ({
          name: (u.name || "").trim(),
          rank: u.rank || i + 1,
          xp: u.totalScore || 0
        }));
      } catch (e) {
        document.getElementById("status").textContent = "Error: " + e.message;
      }
    }

    const input = document.getElementById("search");
    const box = document.getElementById("autocomplete");

    function render(matches) {
      box.innerHTML = ""; box.style.display = matches.length ? "block" : "none";
      matches.slice(0, 40).forEach(u => {
        const div = document.createElement("div"); div.className = "auto-item";
        div.innerHTML = `<strong>${escapeHtml(u.name)}</strong> <small>(#${u.rank}) ‚Äì ${u.xp.toLocaleString()} XP</small>`;
        div.onclick = () => { input.value = u.name; box.style.display = "none"; document.getElementById("psg1-section").style.display = "flex"; showResult(u); };
        box.appendChild(div);
      });
    }

    input.addEventListener("input", () => {
      const q = input.value.trim().toLowerCase();
      if (!q) { render([]); document.getElementById("psg1-section").style.display = "none"; return; }
      render(users.filter(u => u.name.toLowerCase().includes(q)));
    });

    function showResult(u) {
      const xpPlay = u.xp * XP_RATE;
      const psg1Play = hasPsg1 ? PSG1_PER_DEVICE * psg1Count : 0;
      const fullPlay = xpPlay + psg1Play; // 100% allocation at snapshot
      
      // With 30% tax
      const instantPlay = fullPlay * (1 - CLAIM_TAX); // 70%
      
      // Staking options (base is 70%, bonuses are additional)
      const stake3Play = fullPlay * 0.80;  // 70% + 10% = 80%
      const stake6Play = fullPlay * 0.98;  // 70% + 40% = 110% (capped at 98% as shown)
      const stake9Play = fullPlay * 1.12;  // 70% + 60% = 130% (adjusted to 112%)
      const stake12Play = fullPlay * 1.40; // 70% + 100% = 170% (adjusted to 140%)

      lastResult = { fullPlay, instantPlay };

      document.getElementById("show-name").textContent = u.name;
      document.getElementById("show-rank").textContent = u.rank;
      document.getElementById("show-xp").textContent = u.xp.toLocaleString();
      
      document.getElementById("full-play").textContent = format(fullPlay);
      document.getElementById("full-usd").textContent = format(fullPlay * currentPrice, 2);
      
      document.getElementById("instant-play").textContent = format(instantPlay);
      document.getElementById("instant-usd").textContent = format(instantPlay * currentPrice, 2);
      
      document.getElementById("stake-3").textContent = format(stake3Play);
      document.getElementById("stake-3-usd").textContent = format(stake3Play * currentPrice, 2);
      
      document.getElementById("stake-6").textContent = format(stake6Play);
      document.getElementById("stake-6-usd").textContent = format(stake6Play * currentPrice, 2);
      
      document.getElementById("stake-9").textContent = format(stake9Play);
      document.getElementById("stake-9-usd").textContent = format(stake9Play * currentPrice, 2);
      
      document.getElementById("stake-12").textContent = format(stake12Play);
      document.getElementById("stake-12-usd").textContent = format(stake12Play * currentPrice, 2);
      
      document.getElementById("output").style.display = "block";
    }

    function updateResult() {
      const selected = users.find(u => u.name.toLowerCase() === input.value.trim().toLowerCase());
      if (selected) showResult(selected);
    }

    function format(n, d = 6) { return Number(n.toFixed(d)).toLocaleString(); }
    function escapeHtml(t) { const div = document.createElement("div"); div.textContent = t; return div.innerHTML; }

    window.onload = async () => {
      await loadData();
      setInterval(() => { for (let i = 0; i < 2; i++) createParticle(); }, 3000);
    };
  </script>
</body>
</html>
